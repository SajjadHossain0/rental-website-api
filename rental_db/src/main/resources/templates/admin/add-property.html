<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{admin/layout}">

<head>
    <title th:text="${pageTitle}">Add Property</title>
</head>

<body>

    <div layout:fragment="content">

        <div class="card">
            <form th:action="@{/admin/properties/save}" th:object="${property}" method="post">
                <input type="hidden" th:field="*{id}">
                <input type="hidden" th:field="*{createdAt}">

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-control" th:field="*{title}" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Unique ID</label>
                        <input type="text" class="form-control" th:field="*{uniqueId}" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" th:field="*{description}" rows="4"></textarea>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Price</label>
                        <input type="number" step="0.01" class="form-control" th:field="*{price}" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Security Deposit</label>
                        <input type="number" step="0.01" class="form-control" th:field="*{securityDeposit}">
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Property Type</label>
                        <select class="form-control" th:field="*{propertyType}">
                            <option value="">Select Type</option>
                            <option th:each="type : ${propertyTypes}" th:value="${type.id}" th:text="${type.name}">Type
                            </option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Area (sq ft)</label>
                        <input type="number" step="0.01" class="form-control" th:field="*{area}">
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Bedrooms</label>
                        <input type="number" class="form-control" th:field="*{bedroom}">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Bathrooms</label>
                        <input type="number" class="form-control" th:field="*{bathroom}">
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Balconies</label>
                        <input type="number" class="form-control" th:field="*{balcony}">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Is Available</label>
                        <select class="form-control" th:field="*{available}">
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Address</label>
                    <input type="text" class="form-control" th:field="*{address}">
                </div>

                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-control" th:field="*{location}">
                </div>

                <div class="form-group">
                    <label class="form-label">Amenities</label>
                    <input type="text" class="form-control" th:field="*{amenities}" placeholder="Comma separated">
                </div>

                <div class="text-right">
                    <a th:href="@{/admin/properties}" class="btn"
                        style="background: #e5e7eb; color: #374151; margin-right: 10px;">Cancel</a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save" style="margin-right: 8px;"></i> Save Property
                    </button>
                </div>

            </form>
        </div>

        <!-- Image Management Section (Only visible when editing) -->
        <div class="card" th:if="${property.id != null}">
            <h3 style="margin-bottom: 20px; font-size: 1.1rem;">Property Images</h3>

            <!-- Existing Images -->
            <div
                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div th:each="img : ${images}"
                    style="position: relative; border: 1px solid #e5e7eb; border-radius: 4px; overflow: hidden;">
                    <img th:src="${img.imageUrl}" alt="Property Image"
                        style="width: 100%; height: 100px; object-fit: cover;">
                    <a th:href="@{/admin/properties/images/delete/{id}(id=${img.id}, propertyId=${property.id})}"
                        style="position: absolute; top: 5px; right: 5px; background: rgba(239, 68, 68, 0.9); color: white; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 50%; text-decoration: none;"
                        onclick="return confirm('Delete this image?')">
                        <i class="fas fa-times" style="font-size: 12px;"></i>
                    </a>
                </div>
                <div th:if="${#lists.isEmpty(images)}" style="grid-column: 1 / -1; color: #6b7280; font-style: italic;">
                    No images uploaded yet.
                </div>
            </div>

            <!-- Add New Image Form -->
            <form th:action="@{/admin/properties/{id}/images/add(id=${property.id})}" method="post"
                style="display: flex; gap: 10px;">
                <input type="text" name="imageUrl" class="form-control" placeholder="Enter Image URL" required>
                <button type="submit" class="btn btn-primary" style="white-space: nowrap;">
                    <i class="fas fa-upload" style="margin-right: 8px;"></i> Add Image
                </button>
            </form>
        </div>

    </div>

</body>

</html>